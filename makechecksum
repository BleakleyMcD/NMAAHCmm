#!/usr/bin/env bash

#a script to create md5 checksums of all files in a directory or a single file and save it to a .md5 file

### CONSTANTS

biwhite=$(tput bold)$(tput setaf 7)
#bired=$(tput bold)$(tput setaf 1)
color_off=$(tput sgr0)
date="$(date +%Y%m%d)"

### FUNCTIONS

makechecksum ()

{
	#name $input as the first arugment sent to script
	input="$1"

	#if argment is a directory, run md5deep
	if [ -d "$input" ] ; then
		target="${input%/}" #strip the trailing /, if any
		target="${target##*/}" #drop the leading directory componenets i.e. get basename
		output="$input"/"$target"_"$date"_checksums.md5 #set .md5 file to $output
		#echo output is "$output"
		md5deep -bre "$input" >> "$output" #create md5 hash (hashes) of $input and write results to $output
		printf "%s${input##*/}%s is a directory.\nMaking checksum of all files in %s$input%s\nWriting to: %s$output%s" "$biwhite" "$color_off" "$biwhite" "$color_off" "$biwhite" "$color_off"
	fi

	#if argment is a file, run md5deep
	if [ -f "$input" ] ; then
		target="${input##*/}" #get basname of $input
		target="${target%.*}" #strip extention from $target
		output="${input%/*}" #get full path parent dirname of $input
		output="$output"/"$target"_"$date"_checksums.md5 #set .md5 file to $output
		#echo output is $output
		md5deep -bre "$input" >> "$output" #create md5 hash (hashes) of $input and write results to $output
		printf "%s"${input##*/}"%s is a file.\nMaking checksum of %s"${input##*/}"%s\nWriting to: %s$output%s" "$biwhite" "$color_off" "$biwhite" "$color_off" "$biwhite" "$color_off"
	fi

	#sort $output
	echo
	printf "Sorting %s${output##*/}\n%s" "$biwhite" "$color_off"
	sort -k 2 -o "$output" "$output"
	echo
	printf "Finished making checksums for %s${input##*/}.\n\nMoving to next job.%s" "$biwhite" "$color_off"
	echo

	shift
}

#call the function(s)

makechecksum "$@"

exit $?
