#!/usr/bin/env bash

#a script to create a the desired directory structure and filenames for DPX packages received from VFS

### CONSTANTS

biwhite=$(tput bold)$(tput setaf 7)
bired=$(tput bold)$(tput setaf 1)
color_off=$(tput sgr0)

### FUNCTIONS

restructureDPX ()

{
printf "%sPlease enter the number of reels your DPX package has: %s" "$biwhite" "$color_off"
read -r reelnumber
echo
printf '%sPlease enter DPX Object ID Number with underscores:\n' "$biwhite"
printf 'ex. 2015_167_10_1\n%s' "$color_off"
read -r dpxid
echo
printf '%sPlease enter DPX Object title with underscores:\n' "$biwhite"
printf 'ex. Juke_Joint\n%s' "$color_off"
read -r title
echo
printf '%sPlease enter destination for directory tree to be created:\n%s' "$biwhite" "$color_off"
read -r dest
echo
printf '%sPlease enter directory to be worked with:\n%s' "$biwhite" "$color_off"
read -r input

case "$reelnumber" in
	1 )
	#make $destination directory ex. 2012_79_1_54__Something_to_Build_On
	destination=("$dest"/"$dpxid"__"$title")
	mkdir "$destination"
	#make $aud directory ex. 2012_79_1_54__Something_to_Build_On_Audio
	aud=("$destination"/"$dpxid"__"$title"__Audio)
	mkdir $aud
	#make $der directory ex. 2012_79_1_54__Something_to_Build_On_Derivatives
	der=("$destination"/"$dpxid"__"$title"__Derivatives)
	mkdir "$der"
	#make $dpx directory ex. 2012_79_1_54__Something_to_Build_On_DPX
	dpx=("$destination"/"$dpxid"__"$title"__DPX)
	mkdir "$dpx"

	echo
	printf "%sMoving files from %s $input\n" "$biwhite" "$color_off"
	#move any .wav files from the $input to the $aud directory
	if [ -d "$aud" ] ; then
		find "$input" -name "*.wav" -exec mv -vi {} "$aud" \;
	else
		printf "%sMissing%s $aud" "$bired" "$color_off"
		exit 1
	fi
	#move any .mov files from the $input to the $der directory
	if [ -d "$der" ] ; then
		find "$input" -name "*.mov" -exec mv -vi {} "$der" \;
	else
		printf "%sMissing%s $der" "$bired" "$color_off"
		exit 1
	fi
	#move any .dpx files from the $input to the $dpx directory
	if [ -d "$dpx" ] ; then
		find "$input" -name "*.dpx" -exec mv -vi {} "$dpx" \;
	else
		echo "%sMissing%s $dpx" "$bired" "$color_off"
		exit 1
	fi

	echo
	printf "%sReaming files in %s$destination\n" "$biwhite" "$color_off"
	find "$aud" -name "*.wav" -exec mv -vi {} "$aud"/"$dpxid"_AUD.wav \;
	find "$der" -name "*ProResHQ.mov" -exec mv -vi {} "$der"/"$dpxid"_DER_01.mov \;
	find "$der" -name "*Uncompressed.mov" -exec mv -vi {} "$der"/"$dpxid"_DER_02.mov \;

	echo
	printf "%sRemoving %s$input\n" "$biwhite" "$color_off"
	rm -vri "$input"
	;;

	2 )
	destination=("$dest"/"$dpxid"__"$title")
	mkdir "$dest"/"$dpxid"__"$title"

	mkdir "$destination"/"$dpxid"__"$title"_R1

	audR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Audio)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Audio

	derR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Derivatives)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Derivatives

	derR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_DPX)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_DPX

	mkdir "$destination"/"$dpxid"__"$title"_R2

	audR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Audio)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Audio

	derR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Derivatives)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Derivatives

	dpxR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_DPX)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_DPX

	echo
	printf "%sMoving files from%s $input" "$biwhite" "$color_off"

	if [ -d "$audR1" ] ; then
		find "$input" -name "*R1*.wav" -exec mv -vi {} "$audR1" \;
	else
		echo "Missing $audR1"
		exit 1
	fi
	if [ -d "$derR1" ] ; then
		find "$input" -name "*R1*.mov" -exec mv -vi {} "$derR1" \;
	else
		echo "Missing $derR1"
		exit 1
	fi
	if [ -d "$dpxR1" ] ; then
		find "$input" -name "*R1*.dpx" -exec mv -vi {} "$dpxR1" \;
	else
		echo "Missing $dpxR1"
		exit 1
	fi


	if [ -d "$audR2" ] ; then
		find "$input" -name "*R2*.wav" -exec mv -vi {} "$audR2" \;
	else
		echo "Missing $audR2"
		exit 1
	fi
	if [ -d "$derR2" ] ; then
		find "$input" -name "*R2*.mov" -exec mv -vi {} "$derR2" \;
	else
		echo "Missing $derR2"
		exit 1
	fi
	if [ -d "$dpxR2" ] ; then
		find "$input" -name "*R2*.dpx" -exec mv -vi {} "$dpxR2" \;
	else
		echo "Missing $dpxR2"
		exit 1
	fi

	echo
	printf "%sRemoving $input\n" "$biwhite" "$color_off"
	rm -vri "$input"

	echo
	printf "%sReaming files in %s$destination\n" "$biwhite" "$color_off"
	find "$destination" -name "*R1*.wav" -exec mv -vi {} "$audR1"/"$dpxid"_R1_AUD.wav \;
	find "$destination" -name "*R1*ProResHQ*.mov" -exec mv -vi {} "$derR1"/"$dpxid"_R1_DER_01.mov \;
	find "$destination" -name "*R1*Uncompressed*.mov" -exec mv -vi {} "$derR1"/"$dpxid"_R1_DER_02.mov \;
	find "$destination" -name "*R2*.wav" -exec mv -vi {} "$audR2"/"$dpxid"_R2_AUD.wav \;
	find "$destination" -name "*R2*ProResHQ*.mov" -exec mv -vi {} "$derR2"/"$dpxid"_R2_DER_01.mov \;
	find "$destination" -name "*R2*Uncompressed*.mov" -exec mv -vi {} "$derR2"/"$dpxid"_R2_DER_02.mov \;
	;;

	3 )
	destination=("$dest"/"$dpxid"__"$title")
	mkdir "$dest"/"$dpxid"__"$title"

	mkdir "$destination"/"$dpxid"__"$title"_R1

	audR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Audio)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Audio

	derR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Derivatives)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_Derivatives

	dpxR1=("$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_DPX)
	mkdir "$destination"/"$dpxid"__"$title"_R1/"$dpxid"__"$title"_R1_DPX

	mkdir "$destination"/"$dpxid"__"$title"_R2

	audR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Audio)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Audio

	derR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Derivatives)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_Derivatives

	dpxR2=("$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_DPX)
	mkdir "$destination"/"$dpxid"__"$title"_R2/"$dpxid"__"$title"_R2_DPX

	mkdir "$destination"/"$dpxid"__"$title"_R3

	audR3=("$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_Audio)
	mkdir "$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_Audio

	derR3=("$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_Derivatives)
	mkdir "$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_Derivatives

	dpxR3=("$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_DPX)
	mkdir "$destination"/"$dpxid"__"$title"_R3/"$dpxid"__"$title"_R3_DPX

	echo
	printf "%sMoving files from%s $input" "$biwhite" "$color_off"

	if [ -d "$audR1" ] ; then
		find "$input" -name "*R1*.wav" -exec mv -vi {} "$audR1" \;
	else
		echo "Missing $audR1"
		exit 1
	fi
	if [ -d "$derR1" ] ; then
		find "$input" -name "*R1*.mov" -exec mv -vi {} "$derR1" \;
	else
		echo "Missing $derR1"
		exit 1
	fi
	if [ -d "$dpxR1" ] ; then
		find "$input" -name "*R1*.dpx" -exec mv -vi {} "$dpxR1" \;
	else
		echo "Missing $dpxR1"
		exit 1
	fi


	if [ -d "$audR2" ] ; then
		find "$input" -name "*R2*.wav" -exec mv -vi {} "$audR2" \;
	else
		echo "Missing $audR2"
		exit 1
	fi
	if [ -d "$derR2" ] ; then
		find "$input" -name "*R2*.mov" -exec mv -vi {} "$derR2" \;
	else
		echo "Missing $derR2"
		exit 1
	fi
	if [ -d "$dpxR2" ] ; then
		find "$input" -name "*R2*.dpx" -exec mv -vi {} "$dpxR2" \;
	else
		echo "Missing $dpxR2"
		exit 1
	fi

	if [ -d "$audR3" ] ; then
		find "$input" -name "*R3*.wav" -exec mv -vi {} "$audR3" \;
	else
		echo "Missing $audR3"
		exit 1
	fi
	if [ -d "$derR3" ] ; then
		find "$input" -name "*R3*.mov" -exec mv -vi {} "$derR3" \;
	else
		echo "Missing $derR3"
		exit 1
	fi
	if [ -d "$dpxR3" ] ; then
		find "$input" -name "*R3*.dpx" -exec mv -vi {} "$dpxR3" \;
	else
		echo "Missing $dpxR3"
		exit 1
	fi

	echo
	printf "%sRemoving $input\n" "$biwhite" "$color_off"
	rm -vri "$input"

	echo
	printf "%sReaming files in %s$destination\n" "$biwhite" "$color_off"
	find "$destination" -name "*R1*.wav" -exec mv -vi {} "$audR1"/"$dpxid"_R1_AUD.wav \;
	find "$destination" -name "*R1*ProResHQ*.mov" -exec mv -vi {} "$derR1"/"$dpxid"_R1_DER_01.mov \;
	find "$destination" -name "*R1*Uncompressed*.mov" -exec mv -vi {} "$derR1"/"$dpxid"_R1_DER_02.mov \;
	find "$destination" -name "*R2*.wav" -exec mv -vi {} "$audR2"/"$dpxid"_R2_AUD.wav \;
	find "$destination" -name "*R2*ProResHQ*.mov" -exec mv -vi {} "$derR2"/"$dpxid"_R2_DER_01.mov \;
	find "$destination" -name "*R2*Uncompressed*.mov" -exec mv -vi {} "$derR2"/"$dpxid"_R2_DER_02.mov \;
	find "$destination" -name "*R3*.wav" -exec mv -vi {} "$audR3"/"$dpxid"_R3_AUD.wav \;
	find "$destination" -name "*R3*ProResHQ*.mov" -exec mv -vi {} "$derR3"/"$dpxid"_R3_DER_01.mov \;
	find "$destination" -name "*R3*Uncompressed*.mov" -exec mv -vi {} "$derR3"/"$dpxid"_R3_DER_02.mov \;
	;;

	*	)
	printf '%sERROR. Presently, this script can only handle DPX packages of 1 or 2 or 3 reels. Check back later.' "$bired"
	echo
	cowsay 'SORRY!'
	;;
esac
}

#call the function(s)

restructureDPX "$@"

exit $?
