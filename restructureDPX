#!/usr/bin/env bash

#a script to create a the desired directory structure and filenames for DPX packages received from VFS

### CONSTANTS

biwhite='\e[1;97m'
bired='\e[1;91m'
color_off='\e[0m'

### FUNCTIONS

restructureDPX ()

{
echo -e "Please enter the number of reels your DPX package has: "
read reelnumber

case "$reelnumber" in
	1 )
	echo -e "${biwhite}"Please enter DPX Object ID Number with underscores:"${color_off}"
	echo -e "${biwhite}"ex. 2015_167_10_1"${color_off}"
	read dpxid

	echo -e "${biwhite}"Please enter DPX Object title with underscores:"${color_off}"
	echo -e "${biwhite}"ex. Juke_Joint"${color_off}"
	read title

	echo -e "${biwhite}"Please enter destination for directory tree to be created:"${color_off}"
	read dest

	destination=("${dest}"/"${dpxid}"__"${title}")
	mkdir "${dest}"/"${dpxid}"__"${title}"

	mkdir "${destination}"/"${dpxid}"__"${title}"

	AUD=("${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_Audio)
	mkdir "${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_Audio

	DER=("${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_Derivatives)
	mkdir "${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_Derivatives

	DPX=("${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_DPX)
	mkdir "${destination}"/"${dpxid}"__"${title}"/"${dpxid}"__"${title}"_DPX

	echo -e "${biwhite}"Please enter directory to be worked with:"${color_off}"
	read input
	echo
	echo -e "${biwhite}"Moving files from "${input}" "${color_off}"

	find "${input}" -name "*.wav" -exec mv -vi {} "${AUD}" \;
	find "${input}" -name "*.mov" -exec mv -vi {} "${DER}" \;
	find "${input}" -name "*.dpx" -exec mv -vi {} "${DPX}" \;

	echo
	echo -e "${biwhite}"Removing "${input}" "${color_off}"
	rm -vri "${input}"

	find "${destination}" -name "*.wav" -exec mv -vi {} "${AUD}"/"${dpxid}"_AUD.wav \;
	find "${destination}" -name "*ProResHQ*.mov" -exec mv -vi {} "${DER}"/"${dpxid}"_DER_01.mov \;
	find "${destination}" -name "*Uncompressed*.mov" -exec mv -vi {} "${DER}"/"${dpxid}"_DER_02.mov \;
	;;

	2 )
	echo -e "${biwhite}"Please enter DPX Object ID Number with underscores:"${color_off}"
	echo -e "${biwhite}"ex. 2015_167_10_1"${color_off}"
	read dpxid

	echo -e "${biwhite}"Please enter DPX Object title with underscores:"${color_off}"
	echo -e "${biwhite}"ex. Juke_Joint"${color_off}"
	read title

	echo -e "${biwhite}"Please enter destination for directory tree to be created:"${color_off}"
	read dest

	destination=("${dest}"/"${dpxid}"__"${title}")
	mkdir "${dest}"/"${dpxid}"__"${title}"

	mkdir "${destination}"/"${dpxid}"__"${title}"_R1

	AUDR1=("${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_Audio)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_Audio

	DERR1=("${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_Derivatives)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_Derivatives

	DPXR1=("${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_DPX)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R1/"${dpxid}"__"${title}"_R1_DPX

	mkdir "${destination}"/"${dpxid}"__"${title}"_R2

	AUDR2=("${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_Audio)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_Audio

	DERR2=("${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_Derivatives)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_Derivatives

	DPXR2=("${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_DPX)
	mkdir "${destination}"/"${dpxid}"__"${title}"_R2/"${dpxid}"__"${title}"_R2_DPX


	echo -e "${biwhite}"Please enter directory to be worked with:"${color_off}"
	read input
	echo
	echo -e "${biwhite}"Moving files from "${input}" "${color_off}"

	find "${input}" -name "*R1*.wav" -exec mv -vi {} "${AUDR1}" \;
	find "${input}" -name "*R1*.mov" -exec mv -vi {} "${DERR1}" \;
	find "${input}" -name "*R1*.dpx" -exec mv -vi {} "${DPXR1}" \;

	find "${input}" -name "*R2*.wav" -exec mv -vi {} "${AUDR2}" \;
	find "${input}" -name "*R2*.mov" -exec mv -vi {} "${DERR2}" \;
	find "${input}" -name "*R2*.dpx" -exec mv -vi {} "${DPXR2}" \;

	echo
	echo -e "${biwhite}"Removing "${input}" "${color_off}"
	rm -vri "${input}"

	find "${destination}" -name "*R1*.wav" -exec mv -vi {} "${AUDR1}"/"${dpxid}"_R1_AUD.wav \;
	find "${destination}" -name "*R1*ProResHQ*.mov" -exec mv -vi {} "${DERR1}"/"${dpxid}"_R1_DER_01.mov \;
	find "${destination}" -name "*R1*Uncompressed*.mov" -exec mv -vi {} "${DERR1}"/"${dpxid}"_R1_DER_02.mov \;
	find "${destination}" -name "*R2*.wav" -exec mv -vi {} "${AUDR2}"/"${dpxid}"_R2_AUD.wav \;
	find "${destination}" -name "*R2*ProResHQ*.mov" -exec mv -vi {} "${DERR2}"/"${dpxid}"_R2_DER_01.mov \;
	find "${destination}" -name "*R2*Uncompressed*.mov" -exec mv -vi {} "${DERR2}"/"${dpxid}"_R2_DER_02.mov \;
	;;

	*	)
	echo -e "${bired}"ERROR. Presently, this script can only handle DPX packages of 1 or 2 reels. Sorry! Check back later."${color_off}"
	;;
esac
}

#call the function(s)

restructureDPX "$@"

exit $?
