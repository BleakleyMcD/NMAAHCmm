#!/usr/bin/env bash
BIWhite='\e[1;97m'
BIRed='\e[1;91m'
Color_Off='\e[0m'

while [ "${*}" != "" ] ; do

	INPUT="${1}"
	DPX_FOLDER="${INPUT}"
	TARGET_FOLDER="/Users/medialab/Desktop/07_DPX_checksums"/$(basename "${DPX_FOLDER}")
	mkdir -p "${TARGET_FOLDER}"

	if [ ! -d "${TARGET_FOLDER}" ] ; then
		printf "${BIWhite}"Creating "${TARGET_FOLDER}" "${Color_Off}"
		echo
	fi

	for file in "${DPX_FOLDER}"/*DPX*/* ; do
		if [ -f "${TARGET_FOLDER}"/*.dpx ] ; then
			printf "${BIWhite}"$(basename "$file") exists, verifying checksum"${Color_Off}"
			rsync -aPhic "$file" "${TARGET_FOLDER}"
			RSYNC_ERR_1="$?"
		else
			rsync -aPhi "$file" "${TARGET_FOLDER}"
			RSYNC_ERR_1="$?"
		fi
		printf "${BIWhite}"rsync exit status is: "${RSYNC_ERR_1}""${Color_Off}"

		if [[ "${RSYNC_ERR_1}" == 0 ]]; then
			#statements
			printf "${BIWhite}"MOVED: $(basename "$file")
		  printf TO DIRECTORY: "${TARGET_FOLDER}""${Color_Off}"
		  echo
	 	else
			printf "${BIRed}"ERRORS"${Color_Off}"
		fi
		break 1
	done

	for md5 in "${DPX_FOLDER}"/*.md5 ; do
		if [ -f "${TARGET_FOLDER}"/*.md5 ] ; then
			printf "${BIWhite}"$(basename "$md5") exists, verifying checksum"${Color_Off}"
			rsync -aPhic "$md5" "${TARGET_FOLDER}"
			RSYNC_ERR_2="$?"
		else
			rsync -aPhi "$md5" "${TARGET_FOLDER}"
			RSYNC_ERR_2="$?"
		fi
			printf "${BIWhite}"rsync exit status is: "${RSYNC_ERR_2}""${Color_Off}"

	 	if [[ "${RSYNC_ERR_2}" == 0 ]]; then
	 		#statements
			printf "${BIWhite}"MOVED: $(basename "$md5")
			printf TO DIRECTORY: "${TARGET_FOLDER}""${Color_Off}"
			echo
		else
			printf "${BIRed}"ERRORS"${Color_Off}"
		fi
	done
	printf "moving on"
	shift

done
echo
printf "${BIWhite}"changed permissions on the following files in directory $(basename "${CHMOD_FOLDER}") to 777:
CHMOD_FOLDER="/Users/medialab/Desktop/07_DPX_checksums"
chmod -vR 777 "${CHMOD_FOLDER}"
